# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

WebVM is a server-less Linux virtual machine that runs entirely in the browser using WebAssembly. It provides client-side x86 virtualization enabling users to run unmodified Debian distributions with native development toolchains in a sandboxed environment.

**Core Technologies:**
- **CheerpX** - x86-to-WebAssembly JIT compiler and Linux syscall emulator
- **SvelteKit** with static adapter - generates static site output
- **xterm.js** - web-based terminal emulator
- **Tailscale** - VPN networking via WebSocket transport
- **Claude AI** - computer use integration for AI-assisted terminal interaction

## Development Commands

```bash
npm install          # Install dependencies
npm run dev          # Start Vite dev server (typically http://localhost:5173)
npm run build        # Production build to /build directory
```

For local development with a disk image, serve via Nginx on port 8081 with the provided `nginx.conf` (includes required COOP/COEP headers).

## Build Modes

The build uses a Vite alias to select the config file:
- Default: `config_public_terminal.js` (production WebVM)
- GitHub Pages: `WEBVM_MODE=github npm run build` uses `config_github_terminal.js` (auto-generated by CI)

## Architecture

```
src/
├── routes/
│   ├── +page.svelte           # Main terminal page entry
│   └── alpine/                # Alpine graphical desktop variant
└── lib/
    ├── WebVM.svelte           # Core VM component - initializes CheerpX, xterm, filesystem mounts
    ├── SideBar.svelte         # Left sidebar with tab navigation
    ├── anthropic.js           # Claude API client (computer_use, bash tools)
    ├── network.js             # Tailscale WebSocket integration
    └── *Tab.svelte            # Sidebar tab components (Networking, Disk, CPU, AI chat, etc.)
```

**Key Patterns:**
- Config files (`config_*.js`) define disk image URL, type ("cloud" for WebSocket, "bytes" for local HTTP), startup command, and environment
- `serviceWorker.js` injects Cross-Origin-Isolation headers at runtime for SharedArrayBuffer support
- The VM runs a Debian Linux environment with development tools; filesystem includes ext2 disk image + virtual mounts (/dev, /proc, /web, /documents)

## CI/CD

GitHub Actions workflow (`.github/workflows/deploy.yml`) handles:
1. Building Docker image from `dockerfiles/`
2. Exporting filesystem to ext2 image
3. Splitting image into 128KB chunks for httpfs
4. Building and deploying to GitHub Pages

Workflow parameters allow customizing Dockerfile path, image size (max 950MB), and deployment options.
